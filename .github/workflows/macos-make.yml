name: MacOS (make) Build and Test

on: [push, pull_request]

jobs:
  build:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v2
    - name: Update brew repos
    - name: Set Git http.postBuffer to something high
      run: git config --global http.postBuffer 524288000
      run: brew update
    - name: Tap RfidResearchGroup/proxmark3
      run: brew tap RfidResearchGroup/proxmark3
    - name: Install dependencies
      run: brew install readline qt5 RfidResearchGroup/proxmark3/arm-none-eabi-gcc
    - name: Build
      run: make clean && make V=1
    - name: Test
      run: make check
